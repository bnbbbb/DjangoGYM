{% extends 'detailbase.html' %} 
{% load static %} 
{% block content %}
{% block extra_head %}
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css">
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
{% endblock %}
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<div class="banner">
    <div class="max-width">
        <div class="banner-contents">
            <p class="sub-text">Health</p>
            <p class="main-text">My BLOG</p>
            <p class="description">
                If you want to get healthier, explore numerous gyms here!
            </p>
        </div>
    </div>
</div>
<div class="view">
    <div class="max-width">
        <section class="wrap-box">
            <div class="inner">
                <form id ="write-form"
                    action="{% url 'blog:edit' pk=post.pk %}"
                    method="post"
                    enctype="multipart/form-data"
                >
                    {% csrf_token %} 
                    {{ form.title }}
                    {{ form.image }}
                    <div id="toast-editor"></div>
                    <textarea name="content" id="id_content" style="display:none;">{{ post.content }}</textarea>
                    <input id="form-content" name="content" type="hidden">
                    <input id="form-thumbnail" name="thumbnail" type="hidden">
                    <img src="{% static 'assets/icon-modify-white.svg' %}" alt="" />
                    <input type="submit" value="수정" class="button" />
                </form>
            </div>
        </section>
    </div>
</div>
{% endblock %}
{% block extra_scripts %}
<script>
    const Editor = toastui.Editor;
    const contentTextarea = document.querySelector("#id_content");

    const editor = new Editor({
        el: document.querySelector("#toast-editor"),
        initialValue: contentTextarea.value,
        height: "500px",
        initialEditType: "markdown",
        previewStyle: "vertical",
    });

    const write_form = document.querySelector('#write-form');
    const form_content = document.querySelector('#form-content')
    const form_thumbnail = document.querySelector('#form-thumbnail')

    write_form.addEventListener("submit", (e) => {
    e.preventDefault()
    form_content.value = editor.getHTML();
    const thumbnail = form_content.value.match(/<img[^>]+src="?([^"\s]+)"?\s*[^>]*>/);
    if (thumbnail) {
        form_thumbnail.value = thumbnail[1];
    }
    else {
        form_thumbnail.value = `/static/images/post-img${Math.floor(Math.random() * 6) + 1}.jpg`
    }
    write_form.submit()
    })
</script>
{% endblock %}
